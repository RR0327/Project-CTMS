{% extends 'transport_app/base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <div class="text-center mb-4">
            <h2 class="fw-bold"><i class="fas fa-user-plus me-2 text-primary"></i>Create Account</h2>
            <p class="text-white-50">Join the CTMS network today</p>
        </div>
        
        <form method="POST" class="needs-validation fade-slide-up">
            {% csrf_token %}
            
            <div class="mb-3">
                <label class="form-label fw-bold">Full Name</label>
                <input type="text" name="name" class="form-control bg-dark text-white border-secondary" 
                       placeholder="Enter your full name" oninput="validateName(this)" required>
                <p id="name-error" class="text-danger small mt-1" style="display: none;">Name can only contain letters and spaces.</p>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label fw-bold">Email</label>
                    <input type="email" name="email" class="form-control bg-dark text-white border-secondary" 
                           placeholder="name@baiust.edu.bd" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold">Role</label>
                    <select name="role" id="role" class="form-select bg-dark text-white border-secondary" 
                            onchange="toggleStudentFields()" required>
                        <option value="" disabled selected>Select your role</option>
                        <option value="student">Student</option>
                        <option value="staff">Staff</option>
                        <option value="faculty">Faculty</option>
                    </select>
                </div>
            </div>

            <div id="student-fields" class="row mb-3" style="display: none;">
                <div class="col-6">
                    <label class="form-label fw-bold">Level</label>
                    <select name="level" class="form-select bg-dark text-white border-secondary">
                        <option value="1">Level 1</option>
                        <option value="2">Level 2</option>
                        <option value="3">Level 3</option>
                        <option value="4">Level 4</option>
                    </select>
                </div>
                <div class="col-6">
                    <label class="form-label fw-bold">Term</label>
                    <select name="term" class="form-select bg-dark text-white border-secondary">
                        <option value="I">Term I</option>
                        <option value="II">Term II</option>
                    </select>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label fw-bold">ID Number</label>
                      <input id="id_number_input" type="text" name="id_number" class="form-control bg-dark text-white border-secondary" 
                          placeholder="Enter your numeric ID" oninput="validateIDNumber(this)" onfocus="idFocus(this)" onblur="idBlur(this)" required>
                      <p id="id-number-error" class="text-danger small mt-1" style="display: none;">ID Number can only contain numbers.</p>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold">Contact Number</label>
                    <input type="tel" name="contact_information" class="form-control bg-dark text-white border-secondary" 
                           pattern="01\d{9}" maxlength="11" placeholder="e.g. 01712345678" oninput="validateContactInfo(this)" required>
                    <p id="contact-info-error" class="text-danger small mt-1" style="display: none;">Enter 11 digits starting with 01 (e.g., 01712345678).</p>
                </div>
            </div>

            <div class="mb-4">
                <label class="form-label fw-bold">Password</label>
                <input type="password" name="password" class="form-control bg-dark text-white border-secondary" required>
            </div>

            <button type="submit" class="btn btn-primary w-100 py-2 fw-bold rounded-pill shadow-lg">Register Now</button>
        </form>
    </div>
    </div>

    <style>
        /* Combined fade + slide-up animation */
        .fade-slide-up { animation: fadeSlideUp 480ms cubic-bezier(.22,.9,.32,1) both; }
        @keyframes fadeSlideUp {
            0% { opacity: 0; transform: translateY(22px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Subtle stagger for inputs/selects/button inside the form */
        .fade-slide-up .form-control,
        .fade-slide-up .form-select,
        .fade-slide-up .btn {
            opacity: 0; transform: translateY(8px); animation: fadeSlideChild 360ms ease both; animation-delay: 120ms;
        }
        .fade-slide-up .form-control:nth-of-type(1) { animation-delay: 140ms; }
        .fade-slide-up .form-control:nth-of-type(2) { animation-delay: 180ms; }
        .fade-slide-up .form-control:nth-of-type(3) { animation-delay: 220ms; }
        .fade-slide-up .form-select:nth-of-type(1) { animation-delay: 160ms; }
        .fade-slide-up .btn { animation-delay: 260ms; }

        @keyframes fadeSlideChild { to { opacity: 1; transform: translateY(0); } }
    </style>

    <script>
    // Original Registration Scripts preserved and polished
    function validateName(input) {
        const regex = /^[A-Za-z\s]*$/;
        document.getElementById("name-error").style.display = regex.test(input.value) ? "none" : "block";
    }

    function validateIDNumber(input) {
        const regex = /^\d*$/;
        document.getElementById("id-number-error").style.display = regex.test(input.value) ? "none" : "block";
        // Ensure the input uses the bootstrap text color when typing
        input.classList.add('text-white');
    }

    function idFocus(input) {
        // keep Bootstrap text color on focus
        input.classList.add('text-white');
    }

    function idBlur(input) {
        // keep Bootstrap text color even when blurred; no inline color overrides
        input.classList.add('text-white');
    }

    function validateContactInfo(input) {
        // Allow empty while typing, otherwise require full 11-digit local Bangladeshi number starting with 01
        const fullRegex = /^01\d{9}$/;
        const showError = input.value.length > 0 && !fullRegex.test(input.value);
        document.getElementById("contact-info-error").style.display = showError ? "block" : "none";
        // Strip non-digits as user types
        input.value = input.value.replace(/\D/g, '').slice(0,11);
    }

    function toggleStudentFields() {
        const role = document.getElementById('role').value;
        const studentFields = document.getElementById('student-fields');
        studentFields.style.display = (role === 'student') ? 'flex' : 'none';
        
        const selects = studentFields.querySelectorAll('select');
        selects.forEach(s => role === 'student' ? s.setAttribute('required', 'true') : s.removeAttribute('required'));
    }
    document.addEventListener("DOMContentLoaded", toggleStudentFields);
</script>
{% endblock %}